{% extends "base.html" %} {% from "macros.jinja" import window_vars with context
%} {% block page %}

<q-card flat>
  <q-card-section>
    <div class="text-h5 q-mb-md">
      Payment extension
    </div>

    <q-card unelevated flat>
      <q-tabs
        v-model="tab"
        dense
        class="text-grey"
        active-color="primary"
        indicator-color="primary"
        align="left"
        narrow-indicator
      >
        <q-tab name="frameworks" label="Frameworks"></q-tab>
      </q-tabs>

      <q-separator></q-separator>

      <q-tab-panels v-model="tab">
        <q-tab-panel name="frameworks">
          <div class="text-h6">Frameworks</div>

          <div>
            <template>
              <q-tabs align="left" v-model="framworktab" inline-label>
                <q-tab name="quasar"
                  ><img src="./static/quasar-framework.png" />QUASAR</q-tab
                >
              </q-tabs>
            </template>

            <template>
              <q-tab-panels v-model="framworktab">

                <q-tab-panel name="quasar" class="text-body1">
                  <p>
                    makes a payment
                  </p>


                  <p>
                    Click here to make a payment
                    <q-btn
                      size="sm"
                      color="primary"
                      @click="getPayment"
                      >here</q-btn
                    > <q-tooltip>payment</q-tooltip>
                  </p>
                </q-tab-panel>

              </q-tab-panels>
            </template>
          </div>
        </q-tab-panel>

      </q-tab-panels>
    </q-card>
  </q-card-section>
</q-card>
{% endblock %} {% block scripts %} {{ window_vars(user) }}

<script>
  var someMapObject = obj => {
    obj._data = _.clone(obj)
    obj.date = Quasar.utils.date.formatDate(
      new Date(obj.time * 1000),
      'YYYY-MM-DD HH:mm'
    )
    // here you can do something with the mapped data
    return obj
  }
  new Vue({
    el: '#vue',
    mixins: [windowMixin],
    data: function () {
      return {
        ///// Declare models/variables /////
        protocol: window.location.protocol,
        location: '//' + window.location.hostname,
        thingDialog: {
          show: false,
          data: {}
        },
        someBool: true,
        splitterModel: 20,
        mysuperpluginData: [],
        tab: 'frameworks',
        framworktab: 'fastapi',
        usefultab: 'magicalg',
        vettedData: ''
      }
    },
    ///// Where functions live /////
    methods: {
      mysuperpluginFunction: function (data) {
        var theData = data
        LNbits.api
          .request(
            'GET', // Type of request
            '/mysuperplugin/api/v1/test/' + theData, // URL of the endpoint
            this.g.user.wallets[0].inkey // Often endpoints require a key
          )
          .then(response => {
            this.mysuperpluginData = response.data.map(someMapObject) // Often whats returned is mapped onto some model
          })
          .catch(error => {
            LNbits.utils.notifyApiError(error) // Error will be passed to the frontend
          })
      },
      getVettedReadme: function () {
        // This is a function that gets the vetted readme from the LNbits repo and converts it from makrdown to html.
        LNbits.api
          .request(
            'GET',
            '/mysuperplugin/api/v1/vetted',
            this.g.user.wallets[0].inkey
          )
          .then(response => {
            this.vettedData = LNbits.utils.convertMarkdown(response.data)
          })
          .catch(error => {
            LNbits.utils.notifyApiError(error)
          })
      },
      getPayment: function () {
        LNbits.api
          .request(
            'GET',
            '/mysuperplugin/api/v1/payment'
          )
          .then(response => {
            console.log(response.data);
          })
          .catch(error => {
            LNbits.utils.notifyApiError(error)
          })
      },
    },
    ///// To run on startup /////
    created: function () {
      self = this // Often used to run a real object, rather than the event (all a bit confusing really)
      self.mysuperpluginFunction('lorum')
      self.getVettedReadme()
    }
  })
</script>
{% endblock %}
